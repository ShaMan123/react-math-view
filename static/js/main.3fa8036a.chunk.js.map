{"version":3,"sources":["../../src/index.tsx","../../src/useCustomElement.ts","App.tsx","index.tsx"],"names":["props","customMapping","ref","useRef","mapping","className","htmlFor","useLayoutEffect","current","fns","Object","key","fn","customEvent","prop","computedKey","value","React","renderToString","JSON","useCustomElement","customElementProps","_ref","useImperativeHandle","virtualKeyboardToggleGlyph","MathWithKeyboard","onFocus","executeCommand","onBlur","console","log","caretPoint","getValue","MathWithKeyboardButton","onClick","style","width","marginTop","xmlns","viewBox","d","App","ReactDOM","render","document","getElementById"],"mappings":"6ZAaA,I,EAAiB,gBAAkD,c,eCVmCA,EAAUC,kBAAuD,IACnK,IAAMC,EAAMC,mBACNC,EAAU,EAAH,CACTC,UADS,QAETC,QAAS,OAFb,GAmDA,OA7CAC,2BAAgB,W,IAGZ,EAFQC,EAAYN,EAAZM,QAiBR,OAbA,IACIC,EAAMC,OAAA,gBACM,SAAAC,GAAG,OAAIX,eAAJ,YADT,KAEG,SAAAW,GAAG,MAAK,CACTA,IAAKP,MAAgBO,qBAA2BA,WAA3CP,eADI,EAETQ,GAAI,mBAAsBZ,KAAWa,EAAXb,OAAtB,SAGZS,SAAY,Y,IAAGE,QAAKC,OAChBJ,2BAID,WACH,GACIC,WAAY,gBAAGE,EAAH,MAAQC,EAAR,YACRJ,wBADQ,SAKrB,CAACJ,EAASJ,EAzBbO,IA6CO,CAlBoBG,OAAA,gBACf,SAAAC,GAAG,QAAMX,eAAN,aADY,QAEf,c,MAGJ,EAFMc,EAAOd,EAAb,GACMe,EAAcX,MAApB,EAWA,OAPIY,EADAC,uBAA+BH,oBAAyBA,QAAWG,IAAvE,gBACYC,yBAARF,GACOF,qBAA0BA,aAA9B,MACKK,eAARH,GAEAA,EAGJ,0BAfR,IAkBA,GD1CiCI,CAAgB,GAA5CC,OAAoBC,OAG3B,OAFAC,8BAAoBrB,GAAK,kBAAMoB,EAAN,UAAqB,CAA9CC,IAEO,gDAAgBF,GAAoBG,2BAA4BN,yBAAelB,EAAD,4BAAoCE,IAAKoB,IAAOtB,WAAiBkB,yBAAelB,EAAhCA,UAAkDA,EAAvL,UEdIyB,EAAmB,SAACzB,GACxB,IAAME,EAAMC,iBAAoB,MAChC,OAAO,kBAAC,EAAD,eACLD,IAAKA,EACLwB,QAAS,WAAO,IAAD,EACb,UAAAxB,EAAIM,eAAJ,SAAamB,eAAe,wBAE9BC,OAAQ,WAAO,IAAD,QACZC,QAAQC,IAAI,QAAZ,UAAqB5B,EAAIM,eAAzB,aAAqB,EAAauB,YAClCF,QAAQC,IAAI,QAAZ,UAAqB5B,EAAIM,eAAzB,aAAqB,EAAawB,SAAS,UAA3C,UAAsD9B,EAAIM,eAA1D,aAAsD,EAAawB,SAAS,UAC5E,UAAA9B,EAAIM,eAAJ,SAAamB,eAAe,yBAE1B3B,KAIFiC,EAAyB,SAACjC,GAC9B,IAAME,EAAMC,iBAAoB,MAChC,OACE,yBAAKE,UAAU,UACb,kBAAC,EAAD,eACEA,UAAU,KACVH,IAAKA,EACL0B,OAAQ,WAAO,IAAD,MACZC,QAAQC,IAAI,QAAZ,UAAqB5B,EAAIM,eAAzB,aAAqB,EAAauB,YAClCF,QAAQC,IAAI,QAAZ,UAAqB5B,EAAIM,eAAzB,aAAqB,EAAawB,SAAS,UAA3C,UAAsD9B,EAAIM,eAA1D,aAAsD,EAAawB,SAAS,YAE1EhC,IAEN,0BAAMkC,QAAS,kCAAMhC,EAAIM,eAAV,aAAM,EAAamB,eAAe,0BAA0BQ,MAAO,CAAEC,MAAO,OAAQC,UAAW,QAAS,yBAAKC,MAAM,6BAA6BC,QAAQ,eAAc,0BAAMC,EAAE,skDAiBpLC,EAZH,WACV,OAAO,6BACL,kBAAC,EAAD,gBACA,kBAAC,EAAD,CAAkBzB,MAAM,WACxB,2BACE,kBAAC,EAAD,CAAkBA,MAAM,YACxB,kBAAC,EAAD,CAAkBA,MAAM,aAE1B,kBAAC,EAAD,KAAyB,6CCvC7B0B,IAASC,OAAO,kBAAC,EAAD,MAASC,SAASC,eAAe,U","file":"static/js/main.3fa8036a.chunk.js","sourcesContent":["import { MathfieldConfig, MathfieldElement } from 'mathlive';\nimport 'mathlive/dist/mathlive.min';\nimport 'mathlive/dist/mathlive-fonts.css';\nimport React, { PropsWithChildren, useImperativeHandle } from 'react';\nimport { renderToString } from 'react-dom/server';\nimport useCustomElement from './useCustomElement';\n\ntype ExcludeKey<K, KeyToExclude> = K extends KeyToExclude ? never : K;\ntype ExcludeField<A, KeyToExclude extends keyof A> = { [K in ExcludeKey<keyof A, KeyToExclude>]: A[K] };\n\nexport declare type MathViewProps = PropsWithChildren<Partial<ExcludeField<MathfieldConfig, 'virtualKeyboardToggleGlyph'> & { value: string, virtualKeyboardToggleGlyph: JSX.Element }>>;\nexport declare type MathViewRef = MathfieldElement;\n\nconst MathView = React.forwardRef<MathfieldElement, MathViewProps>((props, ref) => {\n  const [customElementProps, _ref] = useCustomElement<MathfieldElement>(props);\n  useImperativeHandle(ref, () => _ref.current!, [_ref]);\n  //@ts-ignore\n  return <math-field {...customElementProps} virtualKeyboardToggleGlyph={renderToString(props.virtualKeyboardToggleGlyph)} ref={_ref}>{props.children ? renderToString(props.children) : props.value}</math-field>\n});\n\nexport default MathView;\n","import React, { PropsWithChildren, useLayoutEffect, useRef } from 'react';\r\nimport { renderToString } from 'react-dom/server';\r\n\r\nexport default function useCustomElement<R extends HTMLElement, P extends PropsWithChildren<{}> = {}>(props: P, customMapping: Partial<{ [key in keyof P]: string }> = {}) {\r\n    const ref = useRef<R>();\r\n    const mapping = {\r\n        className: 'class',\r\n        htmlFor: 'for',\r\n        ...customMapping\r\n    };\r\n\r\n    useLayoutEffect(() => {\r\n        const { current } = ref;\r\n\r\n        let fns: { key: string, fn: (customEvent: any) => any }[];\r\n\r\n        if (current) {\r\n            fns = Object.keys(props)\r\n                .filter(key => props[key] instanceof Function)\r\n                .map(key => ({\r\n                    key: mapping[key] || key.indexOf('on') === 0 && key.slice(2).toLowerCase() || key,\r\n                    fn: (customEvent: any) => props[key](customEvent.detail, customEvent),\r\n                }));\r\n\r\n            fns.forEach(({ key, fn }) => {\r\n                current.addEventListener(key, fn);\r\n            });\r\n        }\r\n\r\n        return () => {\r\n            if (current) {\r\n                fns.forEach(({ key, fn }) =>\r\n                    current.removeEventListener(key, fn),\r\n                );\r\n            }\r\n        };\r\n    }, [mapping, props, ref]);\r\n\r\n    const customElementProps = Object.keys(props)\r\n        .filter(key => !(props[key] instanceof Function))\r\n        .reduce((acc, key) => {\r\n            const prop = props[key];\r\n            const computedKey = mapping[key] || key;\r\n            let value;\r\n\r\n            if (React.isValidElement(prop) || (prop instanceof Array && prop.every(React.isValidElement))) {\r\n                value = renderToString(prop as React.ReactElement);\r\n            } else if (prop instanceof Object || prop instanceof Array) {\r\n                value = JSON.stringify(prop);\r\n            } else {\r\n                value = prop;\r\n            }\r\n\r\n            return { ...acc, [computedKey]: value };\r\n        }, {});\r\n\r\n    return [customElementProps, ref] as [Partial<P>, React.RefObject<R>];\r\n};","import React, { useRef } from 'react';\nimport MathView, { MathViewProps, MathViewRef } from 'react-math-view';\n\nconst MathWithKeyboard = (props: MathViewProps) => {\n  const ref = useRef<MathViewRef>(null);\n  return <MathView\n    ref={ref}\n    onFocus={() => {\n      ref.current?.executeCommand('showVirtualKeyboard');\n    }}\n    onBlur={() => {\n      console.log('caret', ref.current?.caretPoint);\n      console.log('value', ref.current?.getValue('spoken'), ref.current?.getValue('latex'));\n      ref.current?.executeCommand('hideVirtualKeyboard')\n    }}\n    {...props}\n  />\n}\n\nconst MathWithKeyboardButton = (props: MathViewProps) => {\n  const ref = useRef<MathViewRef>(null);\n  return (\n    <div className=\"inline\">\n      <MathView\n        className=\"f1\"\n        ref={ref}\n        onBlur={() => {\n          console.log('caret', ref.current?.caretPoint);\n          console.log('value', ref.current?.getValue('spoken'), ref.current?.getValue('latex'));\n        }}\n        {...props}\n      />\n      <span onClick={() => ref.current?.executeCommand('toggleVirtualKeyboard')} style={{ width: '21px', marginTop: '4px' }}><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 576 512\"><path d=\"M528 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h480c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm16 336c0 8.823-7.177 16-16 16H48c-8.823 0-16-7.177-16-16V112c0-8.823 7.177-16 16-16h480c8.823 0 16 7.177 16 16v288zM168 268v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm96 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm96 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm96 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm-336 80v-24c0-6.627-5.373-12-12-12H84c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm384 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zM120 188v-24c0-6.627-5.373-12-12-12H84c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm96 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm96 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm96 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm96 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm-96 152v-8c0-6.627-5.373-12-12-12H180c-6.627 0-12 5.373-12 12v8c0 6.627 5.373 12 12 12h216c6.627 0 12-5.373 12-12z\"></path></svg></span>\n    </div>\n  );\n}\n\nconst App = () => {\n  return <div>\n    <MathWithKeyboard>\\alpha</MathWithKeyboard>\n    <MathWithKeyboard value=\"\\beta\" />\n    <p>\n      <MathWithKeyboard value=\"\\gamma\" />\n      <MathWithKeyboard value=\"\\delta\" />\n    </p>\n    <MathWithKeyboardButton>{\"x=\\\\frac{-b\\\\pm\\\\sqrt{b ^ 2 - 4ac}}{2a}\"}</MathWithKeyboardButton>\n  </div>\n}\n\nexport default App;\n","import './index.css'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}